<!doctype html>
<html>
<head>
    <title></title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <style>
        .cycle-diagram td {
            width: 48px;
            text-align: center;
            font-family: monospace;
            padding: 8px 0 !important;
        }
        .cycle-diagram td > i {
            padding: 0px;
            border: 1px solid #CCC;
            background: #F0F0F0;
            font-style: normal;
            width: 36px;
            display: inline-block;
        }
        .cycle-diagram td > i.shortcut {
            border: 1px solid #20A060;
            background: #40F080;
        }
        .cycle-diagram td > i.shortcut.start:after {
            content: "↓";
            font-weight: bold;
        }
        .cycle-diagram td > i.shortcut.end:before {
            content: "↑";
            font-weight: bold;
        }
        .cycle-diagram td:first-child {
            text-align: right;
            font-family: monospace;
            white-space: nowrap;
            padding: 8px !important;
        }
        .cycle-diagram th {
            text-align: center;
        }
        .cycle-diagram tfoot > tr > td{
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-2 col-xs-1 affix"> 
            <!--style="background: url(e_ei1061_i02-1_1.png)"-->
                <h2>EI1061</h2>
                <h1>I2</h1>
                <h3>2013/14</h3>
                <ul class="nav nav-pills nav-stacked">
                    <li><a href="#1">Ejercicio 1</a></li>
                    <li><a href="#2">Ejercicio 2</a></li>
                    <li><a href="#3">Ejercicio 3</a></li>
                    <li><a href="#4">Ejercicio 4</a></li>
                    <li><a href="#5">Ejercicio 5</a></li>
                    <li><a href="#6">Ejercicio 6</a></li>
                    <li><a href="#7">Ejercicio 7</a></li>
                </ul>
            </div>
            <div class="col-xs-11 col-md-10 col-md-offset-2 col-xs-offset-1">
                <h1>Entregable I2</h1>
                <h2>EI1061 &#x2014; Arquitecturas Avanzadas</h2>
                <dl>
                    <dt>Apellidos y nombre:</dt>
                    <dt>Tiempo estimado:</dt>
                    <dd>3h</dd>
                    <dt>Tiempo empleado:</dt>
                </dl>
                <h2>Riesgos de control</h2>
                <ol>
                    <li><a name="1"></a>
                        <p>Lee la sección 2.3.2 del capítulo 2 del libro “Arquitectura de Computadores” (≈ 5 páginas). Identifica aquellas partes que se corresponden con los objetivos formativos de dicho tema (los objetivos formativos del tema 1 están en un documento propio en el Aula Virtual).</p>
                        <blockquote><strong>1.5</strong> Explicar en qué consisten los riesgos de control, y sus causas, consecuencias y soluciones</blockquote>
                    </li>
                    <li><a name="2"></a>
                        <p>Distingue entre evaluar la condición de salto y resolver el salto: Evaluar la condición supone realizar las operaciones necesarias para conocer si el salto se debe producir o no. Resolver un salto incluye evaluarlo, realizar las operaciones necesarias para averiguar la dirección de salto y escribir esa dirección en el PC.</p>
                    </li>
                    <li><a name="3"></a>
                        <p>Considera el procesador sencillo (4 etapas: <code>IF</code>, <code>ID</code>, <code>ALU</code>, <code>OS</code>, de un ciclo cada una), donde los riesgos de control se resuelven insertando instrucciones <code>nop</code> tras el salto. ¿Cuántas instrucciones <code>nop</code> sería necesario insertar si el salto se resuelve en la etapa ALU? ¿Por qué?</p>
                        <blockquote>Dos instrucciones <code>nop</code>, ya que no se podría saber si se da la condición de salto hasta el tercer ciclo de la instrucción que precede al salto. Si el salto es efectivo, el nuevo PC se calcula en la tercera etapa de la instrucción del salto, y para entonces ya hay dos instrucciones en el cauce de ejecución.</blockquote>
                    </li>
                    <li><a name="4"></a>
                        <p>En el procesador sencillo, si el salto se resuelve en la etapa <code>ID</code>, ¿cuántas instrucciones <code>nop</code> sería necesario insertar y qué tipo de dato (direccionamiento) podremos usar para el desplazamiento respecto al PC? ¿Por qué?</p>
                        <blockquote>Basta una instrucción <code>nop</code>, pues en el segundo ciclo de la instrucción del salto ya se puede calcular el nuevo PC, usando para ello un offset sumado al PC actual, que se extrae directamente de un campo de la instrucción.</blockquote>
                    </li>
                    <li><a name="5"></a>
                        <p>En el procesador sencillo, a la hora de evaluar el salto en la etapa <code>ID</code>, ¿qué ventaja presenta el formato de instrucción de salto <code>bz r3, despl</code>, donde el salto se produce si <code>r3</code> es cero, frente al formato <code>bz despl</code>, donde el salto se produce si el resultado de la instrucción anterior al salto fue cero? Ilustra tu respuesta mediante algún ejemplo.</p>
                        <blockquote>En el caso del formato <code>bz r3, despl</code>, tenemos que al poder especificar sobre qué registro se hace la comparación con 0, no es necesario esperar a que la etapa <code>ALU</code> de la anterior instrucción termine si no hay dependencias en el salto. En el otro formato la dependencia entre la instrucción anterior al salto y la del salto obliga a que vayan seguidas y no pueden intercalarse instrucciones no dependientes entre ambas.</blockquote>
                    </li>
                    <li><a name="6"></a>
                        <p>Considera el siguiente código</p>
                        <pre><code>addi r1, r0, 20
bucle: add r2, r2, r1
multi r3, r1, 2
add r4, r4, r3
addi r1, r1, -1
bnez r1, bucle
add r5, r2, r4
sub r6, r2, r4
mult r7, r2, r4</code></pre>
                        <p>¿Si r0=0, cuántos ciclos necesita el procesador sencillo para ejecutarlo si los saltos se resuelven en la etapa ID y se tratan mediante la parada del cauce? Asume que existen caminos de atajo en el procesador. ¿Cuántos ciclos necesita el procesador sencillo para ejecutarlo si los saltos se resuelven en la etapa ALU y se tratan mediante la técnica de salto retardado? Reorganiza el código si es posible para minimizar el efecto negativo del salto.</p>
<table class="cycle-diagram table table-striped">
<caption><strong>Resolución en ID, tratamiento con parada</strong></caption>
<thead>
    <tr>
        <th>Ciclo</th>
        <th>1</th>
        <th>2</th>
        <th>3</th>
        <th>4</th>
        <th>5</th>
        <th>6</th>
        <th>7</th>
        <th>8</th>
        <th>9</th>
        <th>10</th>
        <th>11</th>
        <th>12</th>
        <th>13</th>
        <th>&hellip;</th>
    </tr>
</thead>
<tbody>
    <tr>
        <td>addi r1, r0, 20</td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut start">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="10"></td>
    </tr>
    <tr>
        <td>bucle: add r2, r2, r1</td>
        <td></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut end">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="9"></td>
    </tr>
    <tr>
        <td>multi r3, r1, 2</td>
        <td colspan="2"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut start">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="8"></td>
    </tr>
    <tr>
        <td>add r4, r4, r3</td>
        <td colspan="3"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut end">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="7"></td>
    </tr>
    <tr>
        <td>addi r1, r1, -1</td>
        <td colspan="4"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut start">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="6"></td>
    </tr>
    <tr>
        <td>bnez r1, bucle</td>
        <td colspan="5"></td>
        <td><i>IF</i></td>
        <td>*</td>
        <td><i class="shortcut end">ID</i></td>
        <td><i>ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="4">← entra en el bucle</td>
    </tr>
    <tr>
        <td>NOP</td>
        <td colspan="7"></td>
        <td style="opacity: 0.5"><i>*</i></td>
        <td style="opacity: 0.5"><i>*</i></td>
        <td style="opacity: 0.5"><i>*</i></td>
        <td style="opacity: 0.5"><i>*</i></td>
        <td colspan="3">← ciclo de parada</td>
    </tr>
    <tr>
        <td></td>
        <td colspan="14">(se repite 20 veces más)</td>
    </tr>
    <tr>
        <th colspan="2">&hellip;</th>
        <th>136</th>
        <th>137</th>
        <th>138</th>
        <th>139</th>
        <th>140</th>
        <th>141</th>
        <th>142</th>
        <th>143</th>
        <th>144</th>
        <th>145</th>
        <th>146</th>
        <th>147</th>
        <th>148</th>
    </tr>
    <tr>
        <td>add r5, r2, r4</td>
        <td colspan="7"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i>ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="3"></td>
    </tr>
    <tr>
        <td>sub r6, r2, r4</td>
        <td colspan="8"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i>ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="2"></td>
    </tr>
    <tr>
        <td>mult r7, r2, r4</td>
        <td colspan="9"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i>ALU</i></td>
        <td><i>OS</i></td>
        <td></td>
    </tr>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="15"><strong>Total:</strong> 4 + 20 &times; 7 + 3 = 147 ciclos</td>
        </tr>
    </tfoot>
</table>
<table class="cycle-diagram table table-striped">
<caption><strong>Resolución en ALU, tratamiento con salto retardado</strong></caption>
<thead>
    <tr>
        <th>Ciclo</th>
        <th>1</th>
        <th>2</th>
        <th>3</th>
        <th>4</th>
        <th>5</th>
        <th>6</th>
        <th>7</th>
        <th>8</th>
        <th>9</th>
        <th>10</th>
        <th>11</th>
        <th>12</th>
        <th>13</th>
        <th>&hellip;</th>
    </tr>
</thead>
<tbody>
    <tr>
        <td>addi r1, r0, 20</td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut start">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="10"></td>
    </tr>
    <tr>
        <td>bucle: add r2, r2, r1</td>
        <td></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut end">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="9"></td>
    </tr>
    <tr>
        <td>multi r3, r1, 2</td>
        <td colspan="2"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut start">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="8"></td>
    </tr>
    <tr>
        <td>addi r1, r1, -1</td>
        <td colspan="3"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut start">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="7"></td>
    </tr>
    <tr>
        <td>bnez r1, bucle</td>
        <td colspan="4"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i class="shortcut end">ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="6">← entra en el bucle</td>
    </tr>
    <tr>
        <td><strong>add r4, r4, r3</strong></td>
        <td colspan="5"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i>ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="5">← reordenada para rellenar</td>
    </tr>
    <tr>
        <td>NOP</td>
        <td colspan="6"></td>
        <td style="opacity: 0.5"><i>*</i></td>
        <td style="opacity: 0.5"><i>*</i></td>
        <td style="opacity: 0.5"><i>*</i></td>
        <td style="opacity: 0.5"><i>*</i></td>
        <td colspan="4">← ciclo de parada</td>
    </tr>
    <tr>
        <td></td>
        <td colspan="14">(se repite 20 veces más)</td>
    </tr>
    <tr>
        <th colspan="2">&hellip;</th>
        <th>116</th>
        <th>117</th>
        <th>118</th>
        <th>119</th>
        <th>120</th>
        <th>121</th>
        <th>122</th>
        <th>123</th>
        <th>124</th>
        <th>125</th>
        <th>126</th>
        <th>127</th>
        <th>128</th>
    </tr>
    <tr>
        <td>add r5, r2, r4</td>
        <td colspan="7"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i>ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="3"></td>
    </tr>
    <tr>
        <td>sub r6, r2, r4</td>
        <td colspan="8"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i>ALU</i></td>
        <td><i>OS</i></td>
        <td colspan="2"></td>
    </tr>
    <tr>
        <td>mult r7, r2, r4</td>
        <td colspan="9"></td>
        <td><i>IF</i></td>
        <td><i>ID</i></td>
        <td><i>ALU</i></td>
        <td><i>OS</i></td>
        <td></td>
    </tr>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="15"><strong>Total:</strong> 4 + 20 &times; 6 + 3 = 127 ciclos</td>
        </tr>
    </tfoot>
</table>
                    </li>
                    <li><a name="7"></a>
                        <p>Una posible solución para los saltos es la técnica de predicción no tomado en la que el procesador sigue ejecutanto la(s) instrucción(es) siguiente(s) al salto como si éste no se tomase y, cuando el salto se resuelve, las aborta si éste sí debía haber sido tomado. Para el código anterior, ¿cuántos ciclos necesita el procesador sencillo para ejecutarlo si los saltos se resuelven en la etapa ID y se tratan mediante la técnica predicción no tomado? ¿y si los saltos se resuelven en la etapa ALU?</p>
                    </li>
                </ol>
                <footer><small>Nota: Este entregable forma parte de la evaluación de la asignatura.</small></footer>
            </div>
        </div>
    </div>
</body>
</html>